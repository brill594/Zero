cmake_minimum_required(VERSION 3.22)
project(zero_llama LANGUAGES C CXX)
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_POSITION_INDEPENDENT_CODE ON)

# è¿™ä»½ CMakeLists åœ¨ app/src/main/cpp
set(LLAMA_DIR "${CMAKE_CURRENT_LIST_DIR}/../../../../third_party/llama.cpp")
if(NOT EXISTS "${LLAMA_DIR}/include/llama.h")
    message(FATAL_ERROR "llama.cpp not found: ${LLAMA_DIR}")
endif()

# Android å¸¸ç”¨å¼€å…³ï¼ˆæŒ‰éœ€æ”¹ï¼‰
set(GGML_OPENMP OFF CACHE BOOL "" FORCE)
set(GGML_NATIVE  OFF CACHE BOOL "" FORCE)
set(GGML_CPU_ARM64 ON CACHE BOOL "" FORCE)
set(GGML_VULKAN OFF CACHE BOOL "" FORCE)
set(GGML_CUDA   OFF CACHE BOOL "" FORCE)
set(GGML_METAL  OFF CACHE BOOL "" FORCE)
set(LLAMA_BUILD_TESTS    OFF CACHE BOOL "" FORCE)
set(LLAMA_BUILD_EXAMPLES OFF CACHE BOOL "" FORCE)
set(BUILD_SHARED_LIBS    OFF CACHE BOOL "" FORCE)

# å¼•å…¥ llama.cpp
add_subdirectory(${LLAMA_DIR} ${CMAKE_BINARY_DIR}/llama-build)

# ä½ çš„ JNI åŠ¨æ€åº“
add_library(llamajni SHARED
        llama_jni.cpp
)

# ğŸ‘‡ å…³é”®ï¼šç”¨ BEFOREï¼ŒæŠŠ include/ å’Œ ggml/include é¢„ç½®åˆ°æœ€å‰ï¼›åƒä¸‡ä¸è¦åŠ ä»“åº“æ ¹ç›®å½•
target_include_directories(llamajni BEFORE PRIVATE
        ${LLAMA_DIR}/include
        ${LLAMA_DIR}/ggml/include
        # å¦‚éœ€ grammarï¼ˆllama-grammar.hï¼‰ï¼Œå†åŠ ï¼š
        # ${LLAMA_DIR}/src
)

target_link_libraries(llamajni
        PRIVATE
        llama
        log
        android
)
